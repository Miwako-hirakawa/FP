<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPè©¦é¨“ ä¸‰æŠå®Œå…¨æ”»ç•¥</title>
    <link rel="stylesheet" href="fp3_3taku.css">
</head>

<body>

    <div class="container">
        <h1 id="page-title">FPè©¦é¨“<br>ä¸‰æŠå®Œå…¨æ”»ç•¥</h1>

        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="start-screen">
            <div style="text-align: left; margin-bottom: 10px;">
                <a href="index.html"
                    style="text-decoration: none; color: #7f8c8d; font-weight: bold; font-size: 1.1em;">&larr;
                    ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
            </div>
            <p style="text-align:center; font-weight:bold;">æŒ‘æˆ¦ã™ã‚‹ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆå„20å•ï¼‰</p>
            <div class="menu-grid">
                <button class="menu-btn btn-random" onclick="startQuiz('random')">
                    ğŸ² ãƒ©ãƒ³ãƒ€ãƒ æ¼”ç¿’
                    <div style="font-size:0.8em; font-weight:normal;">å…¨å•ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œ</div>
                </button>
                <button class="menu-btn btn-new" onclick="startQuiz('new')">
                    ğŸ”° æœªå›ç­”ãƒ»æ–°å•ã‚³ãƒ¼ã‚¹
                    <div style="font-size:0.8em; font-weight:normal;">ã¾ã è§£ã„ã¦ã„ãªã„å•é¡Œã‚’å„ªå…ˆã—ã¦å‡ºé¡Œ</div>
                    <span class="badge" id="badge-new">æ®‹ -å•</span>
                </button>
                <button class="menu-btn btn-weak" onclick="startQuiz('weak')">
                    ğŸ’ª å¼±ç‚¹å…‹æœã‚³ãƒ¼ã‚¹
                    <div style="font-size:0.8em; font-weight:normal;">é–“é•ãˆãŸå•é¡Œã‚’å„ªå…ˆã—ã¦å‡ºé¡Œ</div>
                    <span class="badge" id="badge-weak">å¯¾è±¡ -å•</span>
                </button>
            </div>
            <div style="text-align:center;">
                <p id="history-status">å­¦ç¿’ãƒ‡ãƒ¼ã‚¿èª­è¾¼ä¸­...</p>
                <button class="btn-reset" onclick="resetHistory()">å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹</button>
            </div>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
        <div id="quiz-interface" style="display: none;">
            <div class="status-bar">
                <span id="mode-display">ã‚³ãƒ¼ã‚¹</span>
                <span id="progress-text">1 / 5 å•</span>
                <button class="btn-quit" onclick="quitQuiz()">ä¸­æ–­ã™ã‚‹</button>
            </div>

            <div class="question-box">
                <div class="source-tag" id="q-source">åˆ†é‡</div>
                <div class="q-header" id="q-text">å•é¡Œæ–‡</div>
                <div class="q-data" id="q-data" style="display:none;"></div>
            </div>

            <div class="options-list" id="options-area">
                <!-- ãƒœã‚¿ãƒ³ã¯JSã§ç”Ÿæˆ -->
            </div>

            <div class="result-area" id="result-feedback">
                <h3 id="result-title"></h3>
                <div id="result-explanation" class="explanation"></div>
                <span class="source-ref" id="result-ref"></span>
                <button class="btn-next" id="next-btn" onclick="nextQuestion()">æ¬¡ã®å•é¡Œã¸</button>
            </div>
        </div>

        <!-- çµ‚äº†ç”»é¢ -->
        <div class="final-score" id="final-screen">
            <h2>è©¦é¨“çµ‚äº†</h2>
            <p>æ­£è§£æ•°</p>
            <div class="score-num" id="final-score-display">0 / 5</div>
            <button class="menu-btn btn-random" style="width:100%; margin-top:20px; text-align:center;"
                onclick="location.reload()">ã‚‚ã†ä¸€åº¦åŒã˜ç§‘ç›®ã‚’è¡Œã†</button>
            <button class="menu-btn" style="width:100%; margin-top:10px; text-align:center; background-color: #95a5a6;"
                onclick="location.href='index.html'">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>
    </div>

    <!-- Dynamic Loader -->
    <script>
        const params = new URLSearchParams(window.location.search);
        const subject = params.get('subject');

        let historyKey = 'fp3_3taku_history'; // Default
        let scriptSrc = '';
        let titleText = '3æŠå®Œå…¨æ”»ç•¥';

        if (subject === 'life') {
            titleText = 'ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°<br>ä¸‰æŠå®Œå…¨æ”»ç•¥';
            historyKey = 'fp3_life_history';
            scriptSrc = 'fp3_3taku_Life_quiz.js';
        } else if (subject === 'risk') {
            titleText = 'ãƒªã‚¹ã‚¯ç®¡ç†<br>ä¸‰æŠå®Œå…¨æ”»ç•¥';
            historyKey = 'fp3_risk_history';
            scriptSrc = 'fp3_3taku_Risk_quiz.js';
        } else if (subject === 'finance') {
            titleText = 'é‡‘èè³‡ç”£é‹ç”¨<br>ä¸‰æŠå®Œå…¨æ”»ç•¥';
            historyKey = 'fp3_finance_history';
            scriptSrc = 'fp3_3taku_Finance_quiz.js';
        } else if (subject === 'tax') {
            titleText = 'ã‚¿ãƒƒã‚¯ã‚¹ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°<br>ä¸‰æŠå®Œå…¨æ”»ç•¥';
            historyKey = 'fp3_tax_history';
            scriptSrc = 'fp3_3taku_Tax_quiz.js';
        } else {
            document.body.innerHTML = '<div class="container"><h1>ã‚¨ãƒ©ãƒ¼</h1><p>ç§‘ç›®ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<a href="index.html">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a></p></div>';
            throw new Error("No subject specified");
        }

        document.title = "FPè©¦é¨“ " + titleText.replace('<br>', ' ');
        document.getElementById('page-title').innerHTML = "FPè©¦é¨“-" + titleText;

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦ã‚»ãƒƒãƒˆï¼ˆlogic.jsã§å‚ç…§ã™ã‚‹æƒ³å®šï¼‰
        window.quizHistoryKey = historyKey;

        // ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿
        const script = document.createElement('script');
        script.src = scriptSrc;
        script.onload = () => {
            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¾Œã«ãƒ­ã‚¸ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚€
            const logicScript = document.createElement('script');
            logicScript.src = 'fp3_3taku_logic.js';
            logicScript.onload = () => {
                // ãƒ­ã‚¸ãƒƒã‚¯èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆæœŸæ›´æ–°ã‚’å®Ÿè¡Œ
                if (typeof updateMenuStatus === 'function') {
                    updateMenuStatus();
                }
            };
            document.body.appendChild(logicScript);
        };
        script.onerror = () => {
            alert("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        };
        document.body.appendChild(script);
    </script>

</body>

</html>